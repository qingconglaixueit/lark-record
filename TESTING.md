# 飞书记录助手 - 测试指南

本指南提供完整的测试流程，帮助您验证飞书记录助手的各项功能。

## 📋 测试前准备

### 环境检查清单

- [ ] Chrome浏览器版本 ≥ 88
- [ ] Go环境版本 ≥ 1.21
- [ ] 飞书开发者账号已创建应用
- [ ] 飞书应用已获得必要权限
- [ ] 后端服务已启动（http://localhost:8080）
- [ ] Chrome扩展已加载
- [ ] 图标文件已生成（icon16.png, icon48.png, icon128.png）

### 生成图标文件

1. 在浏览器中打开 `icons/create-icons.html`
2. 点击"下载所有图标"按钮
3. 将下载的三个图标文件保存到 `icons` 目录
4. 重新加载Chrome扩展

## 🧪 功能测试

### 测试1：后端服务启动测试

**测试目的**：验证Go后端服务能否正常启动

**测试步骤**：
1. 打开命令行终端
2. 进入项目目录
3. 运行 `start.bat`（Windows）或 `./start.sh`（Linux/Mac）

**预期结果**：
```
========================================
启动后端服务...
服务地址: http://localhost:8080
按 Ctrl+C 停止服务
========================================
```

**验证方法**：
- 访问 http://localhost:8080/api/config
- 应该返回配置信息或"未配置"错误

### 测试2：飞书应用配置测试

**测试目的**：验证飞书应用ID和Secret是否有效

**测试步骤**：
1. 右键点击扩展图标，选择"选项"
2. 在"飞书应用配置"区域填写：
   - App ID：您的飞书应用ID
   - App Secret：您的飞书应用密钥
3. 点击"测试配置"按钮

**预期结果**：
- 显示"配置有效！"提示
- "2. 选择多维表格"区域自动显示

**验证方法**：
- 检查浏览器控制台是否有错误
- 检查后端控制台是否有请求日志

### 测试3：多维表格加载测试

**测试目的**：验证能否正确加载用户有权限访问的多维表格

**测试步骤**：
1. 在配置页面点击"加载多维表格"按钮
2. 等待表格列表加载

**预期结果**：
- 显示多维表格列表
- 每个表格显示名称和app_token
- 至少显示一个表格（如果用户有权限访问）

**验证方法**：
- 检查表格名称是否与飞书中的一致
- 检查app_token格式是否正确

### 测试4：数据表和字段加载测试

**测试目的**：验证能否正确加载数据表和字段信息

**测试步骤**：
1. 在多维表格列表中，点击选择一个表格
2. 在"选择数据表"下拉菜单中选择一个数据表
3. 等待字段列表加载

**预期结果**：
- 显示"待写入字段"复选框列表
- 显示"需检测的字段"复选框列表
- 每个字段显示名称和类型
- "3. 消息通知配置"区域自动显示

**验证方法**：
- 检查字段名称和类型是否与飞书表格一致
- 检查字段数量是否正确

### 测试5：配置保存测试

**测试目的**：验证配置能否正确保存和恢复

**测试步骤**：
1. 在"待写入字段"中至少选择一个字段
2. 在"需检测的字段"中选择几个字段（可选）
3. 在"群聊ID"中填写群聊ID（可选）
4. 点击"保存配置"按钮
5. 刷新页面
6. 查看"当前配置"区域

**预期结果**：
- 显示"配置保存成功！"提示
- "当前配置"区域显示完整的配置信息
- 刷新页面后配置信息仍然存在

**验证方法**：
- 检查Chrome存储中的配置（开发者工具 -> Application -> Storage -> Local Storage）
- 检查配置信息是否完整

### 测试6：Popup界面加载测试

**测试目的**：验证Popup界面能否正确加载和显示状态

**测试步骤**：
1. 点击扩展图标打开Popup
2. 观察界面显示

**预期结果**：
- 如果已配置：显示多维表格列表
- 如果未配置：显示"未配置"提示，并有"去配置"按钮

**验证方法**：
- 检查界面布局是否正常
- 检查样式是否正确加载

### 测试7：多维表格选择测试

**测试目的**：验证能否在Popup中选择多维表格

**测试步骤**：
1. 在Popup中点击选择一个多维表格
2. 等待字段输入界面加载

**预期结果**：
- 显示数据输入界面
- 显示表格名称
- 显示与配置的"待写入字段"对应的输入框
- 每个输入框显示字段名称作为标签

**验证方法**：
- 检查输入框数量是否与配置一致
- 检查字段名称是否正确

### 测试8：数据提交测试

**测试目的**：验证能否成功提交数据到飞书多维表格

**测试步骤**：
1. 在所有输入框中填写测试数据
2. 点击"记录数据"按钮
3. 等待提交结果

**预期结果**：
- 按钮显示"提交中..."
- 提交成功后显示"记录成功！"提示
- 3秒后自动返回表格选择界面
- 输入框被清空

**验证方法**：
- 在飞书中打开对应的多维表格
- 检查是否有新增的记录
- 检查记录的字段值是否正确

### 测试9：必填字段验证测试

**测试目的**：验证必填字段验证功能

**测试步骤**：
1. 在Popup中选择一个多维表格
2. 留空一个或多个输入框
3. 点击"记录数据"按钮

**预期结果**：
- 显示"请填写所有必填字段"错误提示
- 未填写的输入框获得焦点
- 数据不会提交

**验证方法**：
- 检查错误提示是否准确
- 检查是否有字段被高亮显示

### 测试10：字段完成检测测试

**测试目的**：验证字段完成检测和消息发送功能

**测试步骤**：
1. 在配置页面设置"需检测的字段"
2. 在Popup中提交一条记录（只填写"待写入字段"）
3. 在飞书中打开对应的多维表格
4. 手动填写"需检测的字段"
5. 等待几秒钟

**预期结果**：
- 当所有"需检测的字段"都有值时
- 后端自动检测到字段完成
- 向配置的群聊发送消息通知

**验证方法**：
- 检查飞书群聊是否收到消息
- 检查消息内容是否包含记录ID
- 检查后端控制台是否有检测日志

### 测试11：切换表格测试

**测试目的**：验证能否在Popup中切换多维表格

**测试步骤**：
1. 在Popup中选择一个多维表格
2. 点击"切换表格"按钮
3. 选择另一个多维表格

**预期结果**：
- 返回到表格选择界面
- 可以重新选择表格
- 输入框被清空

**验证方法**：
- 检查界面切换是否流畅
- 检查是否有数据残留

### 测试12：配置修改测试

**测试目的**：验证能否修改现有配置

**测试步骤**：
1. 在配置页面修改一些配置项（如选择不同的字段）
2. 点击"保存配置"
3. 打开Popup，查看是否应用新配置

**预期结果**：
- 配置更新成功
- Popup中显示新的输入框

**验证方法**：
- 检查配置是否正确更新
- 检查新配置是否生效

## 🐛 问题排查

### 常见问题及解决方案

#### 问题1：后端服务启动失败

**症状**：运行`start.bat`时报错

**可能原因**：
- Go环境未安装或版本不匹配
- 端口8080被占用
- 依赖安装失败

**解决方案**：
```bash
# 检查Go版本
go version

# 检查端口占用
netstat -ano | findstr :8080  # Windows
lsof -i :8080                 # Linux/Mac

# 手动安装依赖
cd backend
go mod tidy
```

#### 问题2：配置测试失败

**症状**：点击"测试配置"显示错误

**可能原因**：
- App ID或Secret错误
- 飞书应用未审核通过
- 权限未授予

**解决方案**：
- 重新检查App ID和Secret
- 确认飞书应用已审核通过
- 检查权限是否正确配置
- 查看浏览器控制台错误信息

#### 问题3：多维表格加载失败

**症状**：点击"加载多维表格"无响应或报错

**可能原因**：
- 飞书应用无访问权限
- 网络连接问题
- 后端服务未启动

**解决方案**：
- 确认飞书应用有访问多维表格的权限
- 检查网络连接
- 确认后端服务已启动
- 查看后端控制台日志

#### 问题4：数据提交失败

**症状**：点击"记录数据"后报错

**可能原因**：
- 字段类型不匹配
- 必填字段未填写
- 后端API错误

**解决方案**：
- 检查输入数据类型是否与字段类型匹配
- 确保所有必填字段已填写
- 查看浏览器控制台错误信息
- 查看后端控制台错误日志

#### 问题5：未收到消息通知

**症状**：字段完成后没有收到消息

**可能原因**：
- 未配置"需检测的字段"
- 未配置群聊ID
- 飞书应用无发送消息权限
- 字段尚未全部有值

**解决方案**：
- 确认已配置"需检测的字段"
- 确认已配置群聊ID
- 确认飞书应用有发送消息权限
- 检查所有"需检测的字段"是否都有值

## 📊 测试报告模板

```
测试日期：____________
测试人员：____________
测试环境：____________

功能测试结果：
[ ] 后端服务启动测试          - 通过 / 失败
[ ] 飞书应用配置测试          - 通过 / 失败
[ ] 多维表格加载测试          - 通过 / 失败
[ ] 数据表和字段加载测试      - 通过 / 失败
[ ] 配置保存测试              - 通过 / 失败
[ ] Popup界面加载测试         - 通过 / 失败
[ ] 多维表格选择测试          - 通过 / 失败
[ ] 数据提交测试              - 通过 / 失败
[ ] 必填字段验证测试          - 通过 / 失败
[ ] 字段完成检测测试          - 通过 / 失败
[ ] 切换表格测试              - 通过 / 失败
[ ] 配置修改测试              - 通过 / 失败

总计：__ 通过，__ 失败

发现问题：
1. 
2. 
3. 

改进建议：
1. 
2. 
3. 

总体评价：____________
```

## 🔧 调试技巧

### 启用详细日志

在浏览器控制台中执行：
```javascript
localStorage.setItem('debug', 'true');
```

### 查看后端日志

后端服务运行时会在控制台输出详细的请求日志，包括：
- 接收到的请求
- 处理过程
- 错误信息

### 检查网络请求

1. 打开开发者工具（F12）
2. 切换到"Network"标签
3. 执行操作
4. 查看HTTP请求和响应

### 检查Chrome存储

1. 打开开发者工具（F12）
2. 切换到"Application"标签
3. 展开"Storage" -> "Local Storage"
4. 查看存储的配置数据

## ✅ 测试完成标准

项目通过测试的标准：

- [ ] 所有功能测试用例通过
- [ ] 无严重bug
- [ ] 无安全漏洞
- [ ] 性能可接受
- [ ] 用户体验良好
- [ ] 文档完整准确

---

如果测试过程中发现任何问题，请记录并反馈给开发团队。